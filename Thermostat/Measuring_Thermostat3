package Thermostat;

import com.phidget22.*;

public class Measuring_Thermostat3 {

    public static void main(String[] args) throws Exception {

        // Create sensor and output/input objects
        TemperatureSensor tempSensor = new TemperatureSensor();
        DigitalOutput greenLED = new DigitalOutput();
        DigitalOutput redLED = new DigitalOutput();
        DigitalInput greenButton = new DigitalInput();
        DigitalInput redButton = new DigitalInput();

        // Set up the devices
        greenLED.setHubPort(4);
        greenLED.setIsHubPortDevice(true);
        greenLED.open(1000);

        redLED.setHubPort(1);
        redLED.setIsHubPortDevice(true);
        redLED.open(1000);

        greenButton.setHubPort(5);
        greenButton.setIsHubPortDevice(true);
        greenButton.open(1000);

        redButton.setHubPort(0);
        redButton.setIsHubPortDevice(true);
        redButton.open(1000);
        
        tempSensor.open(1000);
        
        // Initialize set temperature
        int setTemperature = 21; // Starting set temperature
        int maxTemperature = 30;  // Maximum set temperature
        int minTemperature = 15;  // Minimum set temperature

        long lastPrintTime = System.currentTimeMillis(); // Track the last print time

        while (true) {
            double currentTemperature = tempSensor.getTemperature();

            // Check if the green button is pressed
            if (greenButton.getState()) {
                if (setTemperature < maxTemperature) {
                    setTemperature++;
                    System.out.println("Set Temperature increased to: " + setTemperature + "˚C");
                } else {
                    System.out.println("Maximum temperature reached: " + setTemperature + "˚C");
                }
                // Debounce
                while (greenButton.getState()) {
                    Thread.sleep(10);
                }
                Thread.sleep(500); // Delay to prevent multiple increments
            }

            // Check if the red button is pressed
            if (redButton.getState()) {
                if (setTemperature > minTemperature) {
                    setTemperature--;
                    System.out.println("Set Temperature decreased to: " + setTemperature + "˚C");
                } else {
                    System.out.println("Minimum temperature reached: " + setTemperature + "˚C");
                }
                // Debounce
                while (redButton.getState()) {
                    Thread.sleep(10);
                }
                Thread.sleep(500); // Delay to prevent multiple decrements
            }

            // Print current and set temperatures every 10 seconds
            long currentTime = System.currentTimeMillis();
            if (currentTime - lastPrintTime >= 10000) { // Check if 10 seconds have passed
                System.out.println("Current Temperature: " + currentTemperature + "˚C");
                System.out.println("Set Temperature: " + setTemperature + "˚C");
                lastPrintTime = currentTime; // Update the last print time
            }

            // Control LEDs based on temperature difference
            if (currentTemperature >= setTemperature - 2 && currentTemperature <= setTemperature + 2) {
                greenLED.setState(true);  // Turn on green LED
                redLED.setState(false);    // Turn off red LED
            } else {
                greenLED.setState(false);  // Turn off green LED
                redLED.setState(true);      // Turn on red LED
            }

            // Short sleep to prevent busy waiting
            Thread.sleep(100);
        }
    }
}
